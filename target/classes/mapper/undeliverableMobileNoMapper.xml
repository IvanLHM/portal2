<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.UndeliverableMobileNoMapper">
    
    <!-- 查找失败的短信记录 -->
    <select id="findFailedSmsRecords" resultType="com.example.demo.entity.UndeliveryMobileNo">
        SELECT 
            mobile_number,
            send_time
        FROM tbl_sms_message 
        WHERE DATE(send_time) = #{date}
        AND status = 'fail'
    </select>

    <!-- 批量插入记录 -->
    <insert id="batchInsert" parameterType="java.util.List">
        INSERT INTO tbl_undeliverable_mobile_no (
            id, mobile_number, send_time, created_at
        ) VALUES 
        <foreach collection="list" item="record" separator=",">
            (
                #{record.id},
                #{record.mobileNumber},
                #{record.sendTime},
                CURRENT_TIMESTAMP
            )
        </foreach>
    </insert>

    <!-- 删除所有记录 -->
    <delete id="deleteAll">
        DELETE FROM tbl_undeliverable_mobile_no
    </delete>
</mapper> 